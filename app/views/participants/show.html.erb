<h3><%= "#{@user.name.capitalize} #{@user.surname.capitalize}" %> <small><%= @user.email %></small></h3>

<div class="row">
	<div class="col-lg-3">
	<%= gravatar_image_tag @user.email, gravatar: {size: 200}%>
	</div>
	<div class="col-lg-9">
		<div>
			<% @user.attributes.each do |key,value| %>
				<% next if key.eql?("_id") || key.empty? || key.eql?("was") %>	
				<p><%= "#{key} : #{value}" %></p>
			<% end %>
		</div>
    <h4>Score in categories</h4>
		<div id="categories"></div>
    <h4>Score in events</h4>
		<div id="events"></div>
		<div>
			Calendar
		</div>
	</div>
</div>

<script>

  var categories = document.getElementById('categories');
  var events = document.getElementById('events');

  var cb = bonsai.run(categories, {
    url: '/assets/PieChart.js',
    code: function(){
      new PieChart({
        <% @user.categories.each do |cat| %>
          <%= cat.name %>: <%= @user.score_for_category(cat) %>,
        <% end %>
      })},
    height: 400,
    width: 700,
    framerate: 50
  });

  var eb = bonsai.run(events, {
    url: '/assets/BarChart.js',
    code: function(){
      new BarChart(80,20,{
        <% @events.each do |ev| %>
          '<%= "#{ev.name} #{ev.date.strftime("%Y-%m-%d")}" %>': <%= @user.score_for_event(ev) %>,
        <% end %>
      });
    },
    height: 80,
    framerate: 50
  });

  window.onresize = function() {
    categories.style.left = (window.innerWidth - 202)/2 - 350 + 'px';
    categories.style.top = window.innerHeight/2 - 200 + 'px';
  };

  window.onresize();

</script>